{% extends "layout.html" %}

{% block content %}
<div class="card text-center my-3 mx-auto" style="max-width: 50rem;">
  <div class="card-header">
    <h2 class="card-title">แปลงข้อความเป็นเสียงพูด</h2>
  </div>
  <div class="card-body">
    <div class="form-group text-start">
      <div class="mb-3 mx-auto" style="max-width: 40rem;">
        <label for="text" class="form-label">ใส่ข้อความ</label>
        <textarea class="form-control" id="text" rows="3" name="text"></textarea>
      </div>
    </div>
    <button id="start-btn" class="btn btn-success" onclick="speak()">แปลงเสียง</button>
  </div>
</div>
<div class="card text-center my-3 mx-auto" style="max-width: 50rem;">
  <div class="card-header">
    <h2 class="card-title">ผลลัพธ์</h2>
  </div>
  <div class="card-body">
    <div class="audio">
      <audio controls id="audio">
        <source src="" type="audio/x-wav">
      </audio>
    </div>
  </div>
</div>

<script type=text/javascript>
  function speak() {
    const textEl = document.querySelector("#text");
    let url = {{ url_for('speech')|tojson }}
    let data = new FormData()
    data.append("text", textEl.value)
    fetch(url, { "method": "POST", "body": data })
      .then((response) => response.blob())
      .then((blob) => {
        var reader = new FileReader();
        reader.readAsDataURL(blob); 
        reader.onloadend = function() {
          var src = reader.result;    
          document.getElementById("audio").pause()
          document.getElementById("audio").setAttribute('src', src)
          document.getElementById("audio").load()
          document.getElementById("audio").play()
        }
      })
  }
</script>
{% endblock %}